<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TranscriptGrab — Generate Content</title>
<meta name="description" content="Paste a YouTube URL, get ready-to-post content for Twitter, LinkedIn, Facebook, Instagram, TikTok, blog, and more.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/content-cards.css">
<style>
  :root {
    --white: #ffffff; --bg: #f8f9fb; --surface: #ffffff; --border: #e5e7ec; --border-light: #eef0f4;
    --text: #0f1115; --text-2: #2d3039; --text-3: #5c5f6a; --text-4: #8f929d; --text-5: #b5b8c2;
    --accent: #0f1115; --accent-hover: #2d3039; --accent-subtle: #f3f4f7;
    --cta: #0071e3; --cta-hover: #0077ED;
    --success: #34c759; --error: #ff3b30;
    --radius: 16px; --radius-sm: 10px;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.03), 0 1px 2px rgba(0,0,0,0.02);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.03);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.07), 0 2px 8px rgba(0,0,0,0.03);
    --transition: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Outfit', -apple-system, sans-serif;
    background: var(--bg);
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,113,227,0.04) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 100% 100%, rgba(120,90,220,0.03) 0%, transparent 50%);
    color: var(--text); min-height: 100vh; -webkit-font-smoothing: antialiased;
  }
  ::selection { background: var(--cta); color: var(--white); }

  /* ===== COMPACT HERO ===== */
  .app-hero { text-align: center; padding: 48px 40px 8px; max-width: 800px; margin: 0 auto; }
  .app-hero h1 { font-size: clamp(28px, 5vw, 40px); font-weight: 900; letter-spacing: -0.04em; line-height: 1.1; margin-bottom: 10px; }
  .app-hero p { font-size: 15px; color: var(--text-3); line-height: 1.5; }

  /* ===== INPUT SECTION ===== */
  .input-section { max-width: 600px; margin: 24px auto 0; padding: 0 40px; display: flex; flex-direction: column; align-items: center; }
  .url-input-wrap {
    width: 100%; position: relative; display: flex; align-items: center;
  }
  .url-input {
    width: 100%; padding: 16px 52px 16px 20px; background: var(--surface); border: 1px solid var(--border);
    border-radius: 100px; font-family: 'IBM Plex Mono', monospace; font-size: 14px; color: var(--text);
    outline: none; transition: all 0.2s; text-align: center;
  }
  .url-input:focus { border-color: var(--cta); box-shadow: 0 0 0 3px rgba(0,113,227,0.1); }
  .url-input::placeholder { color: var(--text-5); }
  .paste-btn {
    position: absolute; right: 6px; width: 40px; height: 40px; border-radius: 50%;
    border: none; background: var(--accent-subtle); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; color: var(--text-3);
  }
  .paste-btn:hover { background: var(--border); color: var(--text); }
  .paste-btn.pasted { background: var(--success); color: var(--white); }
  .paste-btn svg { width: 18px; height: 18px; }

  /* ===== FORMAT PICKER ===== */
  .format-picker { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 20px; }
  .format-pill {
    padding: 8px 18px; border: 1px solid var(--border); border-radius: 100px;
    font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 500; color: var(--text-3);
    cursor: pointer; transition: all 0.2s; background: var(--surface); user-select: none;
    display: inline-flex; align-items: center; gap: 6px;
  }
  .format-pill:hover { border-color: var(--text-4); color: var(--text-2); }
  .format-pill.selected { background: var(--text); color: var(--white); border-color: var(--text); }
  .format-pill .pill-icon { font-size: 14px; }

  .generate-btn {
    margin-top: 20px; padding: 16px 48px; background: var(--cta); color: var(--white); border: none; border-radius: 100px;
    font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer;
    transition: all 0.2s; white-space: nowrap;
  }
  .generate-btn:hover { background: var(--cta-hover); transform: translateY(-1px); box-shadow: 0 8px 32px rgba(0,113,227,0.2); }
  .generate-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

  .input-hint { font-size: 12px; color: var(--text-5); margin-top: 12px; }

  /* ===== ERROR ===== */
  .error-msg { max-width: 600px; margin: 16px auto 0; padding: 0 40px; }
  .error-msg p { background: #fff5f5; border: 1px solid #fecaca; border-radius: var(--radius-sm); padding: 12px 16px; font-size: 13px; color: var(--error); }

  /* ===== PROCESSING STATE ===== */
  .processing { text-align: center; padding: 64px 24px; max-width: 640px; margin: 0 auto; }
  .spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--cta); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .processing p { font-size: 15px; color: var(--text-3); }
  .processing .substep { font-size: 13px; color: var(--text-4); margin-top: 6px; }

  /* ===== RESULTS ===== */
  .results { max-width: 1200px; margin: 0 auto; padding: 0 40px 80px; }
  .results-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; padding-top: 32px; }
  .results-header h2 { font-size: 24px; font-weight: 800; letter-spacing: -0.03em; }
  .download-all-btn {
    padding: 10px 24px; background: var(--accent); color: var(--white); border: none; border-radius: 100px;
    font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;
  }
  .download-all-btn:hover { background: var(--accent-hover); transform: translateY(-1px); }

  /* ===== PAYWALL ===== */
  .paywall-overlay {
    position: fixed; inset: 0; z-index: 9000;
    background: rgba(15,17,21,0.3); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
    padding: 24px; animation: fadeIn 0.2s ease;
  }
  .paywall-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: 24px;
    padding: 48px 40px; max-width: 480px; width: 100%; text-align: center;
    box-shadow: 0 24px 80px rgba(0,0,0,0.12), 0 8px 24px rgba(0,0,0,0.06); animation: tgSlideUp 0.3s ease;
  }
  .paywall-card h2 { font-size: 28px; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 10px; line-height: 1.2; }
  .paywall-card p { font-size: 15px; color: var(--text-3); margin-bottom: 32px; line-height: 1.5; }
  .paywall-btns { display: flex; flex-direction: column; gap: 12px; }
  .paywall-btn {
    display: block; width: 100%; padding: 16px; border: none; border-radius: 100px;
    font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer;
    transition: all 0.2s; text-decoration: none; text-align: center;
  }
  .paywall-btn.primary { background: var(--cta); color: var(--white); }
  .paywall-btn.primary:hover { background: var(--cta-hover); transform: translateY(-1px); box-shadow: 0 8px 32px rgba(0,113,227,0.2); }
  .paywall-btn.secondary { background: var(--accent); color: var(--white); }
  .paywall-btn.secondary:hover { background: var(--accent-hover); transform: translateY(-1px); }
  .paywall-restore {
    display: block; width: 100%; background: none; border: none; padding: 14px;
    font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 500; color: var(--text-4);
    cursor: pointer; transition: color 0.2s; margin-top: 4px;
  }
  .paywall-restore:hover { color: var(--text-3); }

  /* ===== NEW VIDEO BTN ===== */
  .new-video-row { text-align: center; margin-top: 32px; }
  .new-video-btn {
    padding: 12px 28px; background: var(--accent-subtle); border: 1px solid var(--border); border-radius: 100px;
    font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 600; color: var(--text);
    cursor: pointer; transition: all 0.2s;
  }
  .new-video-btn:hover { background: var(--border); }

  /* ===== SAVED BADGE ===== */
  .saved-badge {
    display: inline-flex; align-items: center; gap: 6px;
    font-size: 13px; font-weight: 600; color: var(--success);
    padding: 6px 16px; border: 1px solid rgba(52,199,89,0.2); border-radius: 100px;
    background: rgba(52,199,89,0.06);
  }
  .saved-badge a { color: var(--cta); text-decoration: none; font-weight: 600; margin-left: 4px; }
  .saved-badge a:hover { text-decoration: underline; }

  /* ===== HIDDEN ===== */
  .hidden { display: none !important; }

  /* ===== ANIMATIONS ===== */
  @keyframes tgSlideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .fade-in { animation: fadeIn 0.4s ease; }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 600px) {
    .app-hero { padding: 32px 24px 4px; }
    .platform-grid { grid-template-columns: 1fr; }
    .results-header { flex-direction: column; gap: 12px; align-items: flex-start; }
    .paywall-card { padding: 36px 24px; }
  }
</style>
</head>
<body>
<script src="/nav.js"></script>
<script src="/pro.js"></script>
<script src="/content-cards.js"></script>

<!-- ===== HERO ===== -->
<section class="app-hero">
  <h1>Turn any YouTube video into content.</h1>
  <p>Paste a URL, pick your platforms, and generate.</p>
</section>

<!-- ===== INPUT ===== -->
<div class="input-section" id="input-section">
  <div class="url-input-wrap">
    <input type="text" class="url-input" id="url-input" placeholder="https://youtube.com/watch?v=..." autocomplete="off" spellcheck="false">
    <button class="paste-btn" id="paste-btn" title="Paste from clipboard">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
    </button>
  </div>

  <div class="format-picker" id="format-picker">
    <button class="format-pill selected" data-format="twitter"><span class="pill-icon">&#120143;</span> Twitter</button>
    <button class="format-pill selected" data-format="linkedin"><span class="pill-icon">in</span> LinkedIn</button>
    <button class="format-pill" data-format="facebook"><span class="pill-icon">f</span> Facebook</button>
    <button class="format-pill" data-format="instagram"><span class="pill-icon">&#128247;</span> Instagram</button>
    <button class="format-pill" data-format="tiktok"><span class="pill-icon">&#9835;</span> TikTok</button>
    <button class="format-pill" data-format="blog"><span class="pill-icon">&#9997;&#65039;</span> Blog</button>
    <button class="format-pill" data-format="quotes"><span class="pill-icon">&#128172;</span> Quotes</button>
    <button class="format-pill" data-format="transcript"><span class="pill-icon">&#128196;</span> Transcript</button>
  </div>

  <button class="generate-btn" id="generate-btn" onclick="handleGenerate()">Generate Content</button>
  <p class="input-hint" id="input-hint">Paste any YouTube video URL</p>
</div>

<!-- ===== ERROR ===== -->
<div class="error-msg hidden" id="error-section">
  <p id="error-text"></p>
</div>

<!-- ===== PROCESSING ===== -->
<div class="processing hidden" id="processing-section">
  <div class="spinner"></div>
  <p id="processing-msg">Fetching transcript...</p>
  <p class="substep" id="processing-sub">This may take a moment</p>
</div>

<!-- ===== RESULTS ===== -->
<div class="results hidden" id="results-section">
  <div class="results-header">
    <h2 id="results-title">Your content is ready</h2>
    <div style="display:flex;align-items:center;gap:12px;">
      <span class="saved-badge hidden" id="saved-badge">Saved to Library <a href="/library" id="saved-link">View</a></span>
      <button class="download-all-btn" onclick="downloadAll()">Download All</button>
    </div>
  </div>
  <div class="platform-grid" id="platform-grid"></div>
  <div class="new-video-row">
    <button class="new-video-btn" onclick="resetApp()">Generate from another video</button>
  </div>
</div>

<script>
(function(){
  'use strict';

  // ==============================
  // FORMAT PICKER
  // ==============================
  document.getElementById('format-picker').addEventListener('click', function(e) {
    var pill = e.target.closest('.format-pill');
    if (!pill) return;
    pill.classList.toggle('selected');
  });

  function getSelectedFormats() {
    var pills = document.querySelectorAll('.format-pill.selected');
    var formats = [];
    pills.forEach(function(p) { formats.push(p.getAttribute('data-format')); });
    return formats;
  }

  // ==============================
  // STATE
  // ==============================
  var currentResult = null;
  var currentTitle = '';
  var currentVideoId = '';
  var currentTranscript = '';

  // ==============================
  // CREDIT HELPERS
  // ==============================
  function getFreeUsed() {
    try { return localStorage.getItem('tg_free_used') === 'true'; } catch(e) { return false; }
  }
  function setFreeUsed() {
    try { localStorage.setItem('tg_free_used', 'true'); } catch(e) {}
  }
  function getCredits() {
    try { return parseInt(localStorage.getItem('tg_credits') || '0', 10); } catch(e) { return 0; }
  }
  function setCredits(n) {
    try { localStorage.setItem('tg_credits', String(n)); } catch(e) {}
  }
  function canGenerate() {
    if (window.TGPro && TGPro.isPro()) return true;
    if (getCredits() > 0) return true;
    if (!getFreeUsed()) return true;
    return false;
  }

  // ==============================
  // PAYWALL
  // ==============================
  function showPaywall() {
    if (window.TGPro) TGPro.showUpgradeModal();
  }
  function hidePaywall() {
    if (window.TGPro) TGPro.hideUpgradeModal();
  }

  function showNoCaptions() {
    if (document.getElementById('nocaptions-overlay')) return;
    var div = document.createElement('div');
    div.className = 'paywall-overlay';
    div.id = 'nocaptions-overlay';
    div.innerHTML =
      '<div class="paywall-card">' +
        '<h2>No captions available</h2>' +
        '<p>This video doesn\u2019t have captions or subtitles enabled, so we can\u2019t extract a transcript.</p>' +
        '<p style="font-size:13px;color:var(--text-4);margin-bottom:24px;">Try a different video, or look for one with auto-generated or manual captions.</p>' +
        '<div class="paywall-btns">' +
          '<button class="paywall-btn primary" onclick="document.getElementById(\'nocaptions-overlay\').remove();resetApp();">Try another video</button>' +
        '</div>' +
      '</div>';
    document.body.appendChild(div);
  }

  // ==============================
  // EXTRACT VIDEO ID
  // ==============================
  function extractVideoId(url) {
    url = url.trim();
    if (/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
    try {
      var u = new URL(url);
      if (u.searchParams.get('v')) return u.searchParams.get('v');
      if (u.hostname === 'youtu.be') return u.pathname.split('/')[1];
      var m = u.pathname.match(/\/(shorts|embed|v)\/([a-zA-Z0-9_-]{11})/);
      if (m) return m[2];
    } catch(e) {}
    var r = url.match(/(?:v=|\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    return r ? r[1] : null;
  }

  // ==============================
  // GENERATE
  // ==============================
  window.handleGenerate = async function() {
    var url = document.getElementById('url-input').value.trim();
    if (!url) { showError('Please paste a YouTube URL.'); return; }

    var videoId = extractVideoId(url);
    if (!videoId) { showError('Could not find a valid YouTube video ID in that URL.'); return; }

    var formats = getSelectedFormats();
    if (formats.length === 0) { showError('Select at least one format.'); return; }

    // Separate transcript (client-side) from AI formats
    var wantTranscript = formats.indexOf('transcript') !== -1;
    var aiFormats = formats.filter(function(f) { return f !== 'transcript'; });

    // Need credits for AI formats, transcript alone is free
    if (aiFormats.length > 0 && !canGenerate()) { showPaywall(); return; }

    hidePaywall();
    showProcessing('Fetching transcript...');

    try {
      // Step 1: Fetch transcript
      var tRes = await fetch('/api/transcript?v=' + videoId, { credentials: 'same-origin' });
      var tData = await tRes.json();
      if (!tRes.ok || !tData.segments) {
        if (tData.no_captions) {
          hideProcessing();
          showNoCaptions();
          return;
        }
        throw new Error(tData.error || 'Could not fetch transcript for this video.');
      }

      currentTitle = tData.title || 'Video';
      currentVideoId = videoId;
      var transcriptText = tData.segments.map(function(s) { return s.text; }).join(' ');
      currentTranscript = tData.segments.map(function(s) {
        var mins = Math.floor(s.start / 60);
        var secs = Math.floor(s.start % 60);
        var ts = String(mins).padStart(2,'0') + ':' + String(secs).padStart(2,'0');
        return '[' + ts + '] ' + s.text;
      }).join('\n');

      var gData = {};

      // Step 2: Generate AI formats (if any selected)
      if (aiFormats.length > 0) {
        var label = aiFormats.length === 1 ? aiFormats[0] : aiFormats.length + ' formats';
        updateProcessing('Generating ' + label + '...', 'This may take a moment');

        var gRes = await fetch('/api/generate', {
          method: 'POST',
          credentials: 'same-origin',
          headers: {
            'Content-Type': 'application/json',
            'x-free-used': getFreeUsed() ? 'true' : 'false'
          },
          body: JSON.stringify({
            transcript: transcriptText,
            formats: aiFormats,
            videoId: videoId,
            videoTitle: currentTitle
          })
        });
        gData = await gRes.json();
        if (gRes.status === 402) {
          hideProcessing();
          showPaywall();
          return;
        }
        if (gRes.status === 403) {
          hideProcessing();
          showError(gData.error || 'Monthly limit reached.');
          return;
        }
        if (!gRes.ok) {
          throw new Error(gData.error || 'Content generation failed.');
        }

        // Mark free usage on first anonymous generation
        if (!getFreeUsed()) setFreeUsed();
      }

      if (wantTranscript) {
        gData._transcript = currentTranscript;
      }

      currentResult = gData;
      renderResults(gData, currentTitle, videoId);

    } catch(err) {
      hideProcessing();
      showError(err.message);
    }
  };

  // ==============================
  // UI HELPERS
  // ==============================
  function showError(msg) {
    var el = document.getElementById('error-section');
    document.getElementById('error-text').textContent = msg;
    el.classList.remove('hidden');
    setTimeout(function(){ el.classList.add('hidden'); }, 8000);
  }

  function showProcessing(msg) {
    document.getElementById('input-section').classList.add('hidden');
    document.getElementById('results-section').classList.add('hidden');
    document.getElementById('error-section').classList.add('hidden');
    var sec = document.getElementById('processing-section');
    document.getElementById('processing-msg').textContent = msg;
    document.getElementById('processing-sub').textContent = 'This may take a moment';
    sec.classList.remove('hidden');
  }
  function updateProcessing(msg, sub) {
    document.getElementById('processing-msg').textContent = msg;
    if (sub) document.getElementById('processing-sub').textContent = sub;
  }
  function hideProcessing() {
    document.getElementById('processing-section').classList.add('hidden');
    document.getElementById('input-section').classList.remove('hidden');
  }

  // ==============================
  // RENDER RESULTS
  // ==============================
  function renderResults(data, title, videoId) {
    document.getElementById('processing-section').classList.add('hidden');
    document.getElementById('input-section').classList.add('hidden');
    var sec = document.getElementById('results-section');
    sec.classList.remove('hidden');
    sec.classList.add('fade-in');
    document.getElementById('results-title').textContent = title;

    // Show saved badge for signed-in users
    var badge = document.getElementById('saved-badge');
    if (window.TGUser && TGUser.isSignedIn() && videoId) {
      document.getElementById('saved-link').href = '/library?v=' + videoId;
      badge.classList.remove('hidden');
    } else {
      badge.classList.add('hidden');
    }

    var grid = document.getElementById('platform-grid');
    TGCards.renderCards(data, grid);
  }

  // ==============================
  // DOWNLOAD HELPERS
  // ==============================
  function writeVariations(parts, data, formatter) {
    if (Array.isArray(data)) {
      data.forEach(function(v, i) {
        parts.push('[Variation ' + (i + 1) + ': ' + (v.label || 'Untitled') + ']\n\n');
        parts.push(formatter(v) + '\n\n');
      });
    } else {
      parts.push(formatter(data) + '\n\n');
    }
  }

  // ==============================
  // DOWNLOAD ALL
  // ==============================
  window.downloadAll = function() {
    if (!currentResult) return;
    var parts = [];
    var title = currentTitle || 'Video';
    parts.push('=== ' + title + ' ===\n');
    parts.push('Generated by TranscriptGrab\n\n');

    if (currentResult._transcript) {
      parts.push('--- TRANSCRIPT ---\n\n' + currentResult._transcript + '\n\n');
    }
    if (currentResult.twitter && currentResult.twitter.tweets) {
      parts.push('--- TWITTER THREAD ---\n\n');
      currentResult.twitter.tweets.forEach(function(t, i) {
        parts.push((i+1) + '/ ' + t + '\n\n');
      });
    }
    if (currentResult.linkedin) {
      parts.push('\n--- LINKEDIN ---\n\n');
      writeVariations(parts, currentResult.linkedin, function(v) { return v.content; });
    }
    if (currentResult.facebook) {
      parts.push('\n--- FACEBOOK ---\n\n');
      writeVariations(parts, currentResult.facebook, function(v) { return v.content; });
    }
    if (currentResult.instagram) {
      parts.push('\n--- INSTAGRAM ---\n\n');
      writeVariations(parts, currentResult.instagram, function(v) { return v.content; });
    }
    if (currentResult.tiktok) {
      parts.push('\n--- TIKTOK ---\n\n');
      writeVariations(parts, currentResult.tiktok, function(v) { return 'Caption:\n' + (v.caption||'') + '\n\nScript:\n' + (v.script||''); });
    }
    if (currentResult.blog) {
      parts.push('\n--- BLOG POST ---\n\n');
      writeVariations(parts, currentResult.blog, function(v) { return '# ' + (v.title||'') + '\n\n' + (v.content||''); });
    }
    if (currentResult.quotes) {
      parts.push('\n--- KEY QUOTES ---\n\n');
      currentResult.quotes.forEach(function(q) {
        parts.push('"' + q.text + '"' + (q.timestamp ? ' [' + q.timestamp + ']' : '') + '\n\n');
      });
    }

    var blob = new Blob([parts.join('')], { type: 'text/plain' });
    var a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = slugify(title) + '-content.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  };

  // ==============================
  // RESET
  // ==============================
  window.resetApp = function() {
    currentResult = null;
    currentTitle = '';
    currentVideoId = '';
    currentTranscript = '';
    document.getElementById('results-section').classList.add('hidden');
    document.getElementById('input-section').classList.remove('hidden');
    document.getElementById('url-input').value = '';
    document.getElementById('url-input').focus();
  };

  // ==============================
  // UTILS
  // ==============================
  function slugify(s) {
    return s.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '').substring(0, 60);
  }

  // ==============================
  // PASTE BUTTON
  // ==============================
  document.getElementById('paste-btn').addEventListener('click', function() {
    var btn = this;
    navigator.clipboard.readText().then(function(text) {
      if (text) {
        document.getElementById('url-input').value = text.trim();
        btn.classList.add('pasted');
        setTimeout(function() { btn.classList.remove('pasted'); }, 1500);
      }
    }).catch(function() {
      // Clipboard permission denied — focus input so user can Ctrl+V
      document.getElementById('url-input').focus();
    });
  });

  // ==============================
  // ENTER KEY
  // ==============================
  document.getElementById('url-input').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') handleGenerate();
  });

  // ==============================
  // INIT — pre-fill from URL params (regenerate from library)
  // ==============================
  var params = new URLSearchParams(window.location.search);
  if (params.get('v')) {
    document.getElementById('url-input').value = 'https://youtube.com/watch?v=' + params.get('v');
  }

})();
</script>
<script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
